---
title: "mIBD GeoMx Spatial Analysis - Cursor Refactored"
author: "Jaecheon Ko"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    code_folding: show
    df_print: paged
    theme: cerulean
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 10,
  fig.height = 8,
  dpi = 300
)
```

# Project Overview

**Project:** mIBD (Inflammatory Bowel Disease) GeoMx Spatial Profiling  
**Data:** NanoString GeoMx Digital Spatial Profiling  
**Goal:** Understand spatial gene expression patterns in pre/post treatment IBD tissues

**Key Steps:**
1. Data loading and metadata integration
2. Quality control
3. Q3 normalization
4. Differential expression analysis (pre vs post treatment)
5. Pathway enrichment
6. Linear mixed models for complex designs
7. Biomarker discovery

---

# 1. Setup

## 1.1 Load Libraries

```{r libraries}
# Core analysis
library(Seurat)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readxl)

# Statistical analysis
library(rstatix)
library(car)
library(broom)
library(lme4)
library(lmerTest)

# Visualization
library(pheatmap)
library(ComplexHeatmap)
library(circlize)
library(ggrepel)

# Machine learning (for biomarker discovery)
library(caret)
library(pROC)
library(glmnet)

# Load refactored myR package
suppressMessages({
  library(devtools)
  setwd("/data/kjc1/mylit/myR")
  load_all()  # Or library(myR) if installed
})

set.seed(1234)
```

## 1.2 Define Paths

```{r paths}
# Project directory
project_dir <- "/data/kjc1/projects/#124. mIBD"

# Data files
data_file <- file.path(project_dir, "Initial Dataset_merged_250729.xlsx")
clinical_file <- file.path(project_dir, "1. biologics naive 이름_병록번호 제외_merged2_250728.xlsx")

# Output directory
output_dir <- file.path(project_dir, "results_cursor")
dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)
```

---

# 2. Data Loading and Preparation

## 2.1 Load Raw Data

```{r load_data}
# Load count matrix
mibd <- read_xlsx(data_file, sheet = "BioProbeCountMatrix") %>%
  as.data.frame()

# Load segment properties (spatial metadata)
mibd_meta_raw <- read_xlsx(data_file, sheet = "SegmentProperties") %>%
  select(-any_of("drug")) %>%
  as.data.frame()

# Load clinical metadata
mibd_meta_clinical <- read_xlsx(clinical_file) %>%
  select(-any_of(c("treatment", "slide", "TMA 순번"))) %>%
  as.data.frame()

# Preview
head(mibd_meta_raw)
head(mibd_meta_clinical)
```

## 2.2 Metadata Integration

```{r metadata_integration}
# Convert clinical metadata to long format (for pre/post samples)
mibd_meta_clinical_long <- mibd_meta_clinical %>% 
  pivot_longer(
    cols = c(key_pre, key_post),
    names_to = "which_key",
    values_to = "key_tma"
  ) %>% 
  select(-which_key)

# Join spatial metadata with clinical data
mibd_meta <- mibd_meta_raw %>%
  mutate(ROILabel = as.numeric(ROILabel)) %>%
  left_join(mibd_meta_clinical_long, by = "key_tma")

# Filter to complete cases
mibd_meta_final <- drop_na(mibd_meta, patho_id, `Endo remission`)

# Prepare count matrix
raw_data <- mibd
rownames(raw_data) <- raw_data$ProbeDisplayName

# Prepare sample metadata
SP <- mibd_meta_final
rownames(SP) <- SP$SegmentDisplayName

# Match samples between count matrix and metadata
common_samples <- intersect(colnames(raw_data)[-1], rownames(SP))
raw_data <- raw_data[, c("ProbeDisplayName", common_samples)]
SP <- SP[common_samples, ]

message("Final dataset: ", nrow(raw_data), " genes x ", ncol(raw_data) - 1, " samples")
```

## 2.3 Create Seurat Object (Optional)

```{r create_seurat}
# Convert to matrix format
count_matrix <- raw_data %>%
  column_to_rownames("ProbeDisplayName") %>%
  as.matrix()

# Create Seurat object for easier downstream analysis
sobj <- CreateSeuratObject(
  counts = count_matrix,
  meta.data = SP,
  min.cells = 0,
  min.features = 0
)

# Add useful combined metadata columns
sobj$timepoint_condition <- paste(sobj$timepoint, sobj$condition, sep = "_")
sobj$patient_timepoint <- paste(sobj$patho_id, sobj$timepoint, sep = "_")

message("Created Seurat object with ", nrow(sobj), " genes and ", ncol(sobj), " ROIs")
```

---

# 3. Quality Control

## 3.1 Sample-Level QC

```{r sample_qc}
# Basic QC metrics
qc_metrics <- data.frame(
  sample = colnames(count_matrix),
  total_counts = colSums(count_matrix),
  n_genes_detected = colSums(count_matrix > 0),
  mean_expression = colMeans(count_matrix)
) %>%
  left_join(SP %>% rownames_to_column("sample"), by = "sample")

# Visualize QC metrics
ggplot(qc_metrics, aes(x = total_counts)) +
  geom_histogram(bins = 30, fill = "steelblue") +
  theme_minimal() +
  ggtitle("Total Counts Distribution")

ggplot(qc_metrics, aes(x = n_genes_detected)) +
  geom_histogram(bins = 30, fill = "coral") +
  theme_minimal() +
  ggtitle("Genes Detected per ROI")

# Box plots by segment type or condition
ggplot(qc_metrics, aes(x = segment, y = total_counts, fill = segment)) +
  geom_boxplot() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Total Counts by Segment Type")
```

## 3.2 Gene-Level QC

```{r gene_qc}
# Gene detection rates
gene_metrics <- data.frame(
  gene = rownames(count_matrix),
  total_counts = rowSums(count_matrix),
  n_samples_detected = rowSums(count_matrix > 0),
  mean_expression = rowMeans(count_matrix),
  detection_rate = rowSums(count_matrix > 0) / ncol(count_matrix)
)

# Visualize
ggplot(gene_metrics, aes(x = detection_rate)) +
  geom_histogram(bins = 30, fill = "purple") +
  theme_minimal() +
  ggtitle("Gene Detection Rate Across Samples")

# Filter low-count genes (optional)
genes_to_keep <- gene_metrics %>%
  filter(detection_rate >= 0.1) %>%  # Detected in at least 10% of samples
  pull(gene)

message("Keeping ", length(genes_to_keep), " / ", nrow(gene_metrics), " genes")
```

## 3.3 Outlier Detection

```{r outlier_detection}
# Check for outlier samples using hierarchical clustering
library(ggdendro)

# Calculate sample distances
sample_dist <- dist(t(count_matrix))
sample_hclust <- hclust(sample_dist, method = "ward.D2")

# Plot dendrogram
ggdendrogram(sample_hclust, rotate = FALSE, size = 2) +
  ggtitle("Sample Clustering Dendrogram")

# Identify potential outliers using z-scores
qc_metrics <- qc_metrics %>%
  mutate(
    z_total = scale(total_counts)[, 1],
    z_genes = scale(n_genes_detected)[, 1],
    is_outlier = abs(z_total) > 3 | abs(z_genes) > 3
  )

# Report outliers
outliers <- qc_metrics %>% filter(is_outlier)
if (nrow(outliers) > 0) {
  message("Potential outliers detected: ", nrow(outliers))
  print(outliers %>% select(sample, total_counts, n_genes_detected, z_total, z_genes))
} else {
  message("No major outliers detected")
}
```

---

# 4. Normalization

## 4.1 Q3 Normalization (GeoMx Standard)

```{r q3_normalization}
# Using refactored GeoMx.R functions

# Q3 normalize
q3_norm <- q3_normalize(count_matrix)

# Update Seurat object with normalized data
sobj <- SetAssayData(sobj, slot = "data", new.data = q3_norm)

# Visualize normalization effect
par(mfrow = c(1, 2))
boxplot(log2(count_matrix[, 1:min(20, ncol(count_matrix))] + 1), 
        main = "Raw Counts (log2)", las = 2, cex.axis = 0.7)
boxplot(log2(q3_norm[, 1:min(20, ncol(q3_norm))] + 1), 
        main = "Q3 Normalized (log2)", las = 2, cex.axis = 0.7)
par(mfrow = c(1, 1))
```

---

# 5. Exploratory Analysis

## 5.1 PCA

```{r pca_analysis}
# Run PCA
sobj <- ScaleData(sobj, features = genes_to_keep)
sobj <- RunPCA(sobj, features = genes_to_keep, npcs = 30, verbose = FALSE)

# Visualize PCA
DimPlot(sobj, reduction = "pca", group.by = "timepoint") +
  ggtitle("PCA by Timepoint")

DimPlot(sobj, reduction = "pca", group.by = "segment") +
  ggtitle("PCA by Segment Type")

# Elbow plot
ElbowPlot(sobj, ndims = 30)
```

## 5.2 UMAP

```{r umap}
# Run UMAP
sobj <- RunUMAP(sobj, dims = 1:20, verbose = FALSE)

# Visualize
p1 <- DimPlot(sobj, reduction = "umap", group.by = "timepoint") +
  ggtitle("UMAP by Timepoint")

p2 <- DimPlot(sobj, reduction = "umap", group.by = "segment") +
  ggtitle("UMAP by Segment")

p3 <- DimPlot(sobj, reduction = "umap", group.by = "patho_id") +
  ggtitle("UMAP by Patient") +
  theme(legend.position = "none")

library(patchwork)
(p1 | p2) / p3
```

---

# 6. Differential Expression Analysis

## 6.1 Simple Pre vs Post Comparison (Wilcoxon)

```{r de_simple}
# Using refactored find_deg_geomx function
deg_simple <- find_deg_geomx(
  data = q3_norm,
  metadata = SP,
  group_col = "timepoint",
  comparison = c("post", "pre"),
  test_method = "wilcox",
  adjust_method = "BH"
)

# View top results
head(deg_simple %>% arrange(p_adj), 20)

# Volcano plot using refactored function
plot_deg_volcano(
  deg_results = deg_simple,
  title = "Pre vs Post Treatment",
  fc_threshold = 1.5,
  pval_threshold = 0.05,
  label_top = 15
)
```

## 6.2 Limma with Covariates

```{r de_limma}
# More sophisticated analysis accounting for patient pairing and segment type
library(limma)

# Prepare design matrix
# Account for paired samples (same patient pre/post)
design <- model.matrix(~ 0 + timepoint + patho_id, data = SP)

# Rename columns for clarity
colnames(design) <- gsub("timepoint", "", colnames(design))
colnames(design) <- gsub("patho_id", "Patient_", colnames(design))

# Define contrast (post - pre)
contrast_matrix <- makeContrasts(
  PostVsPre = post - pre,
  levels = design
)

# Fit model
fit <- lmFit(log2(q3_norm + 1), design)
fit2 <- contrasts.fit(fit, contrast_matrix)
fit2 <- eBayes(fit2)

# Extract results
deg_limma <- topTable(fit2, coef = "PostVsPre", number = Inf) %>%
  rownames_to_column("gene") %>%
  arrange(adj.P.Val)

# View top results
head(deg_limma, 20)

# Volcano plot
plot_deg_volcano(
  deg_results = deg_limma %>% 
    rename(log2FC = logFC, p_val = P.Value, p_adj = adj.P.Val),
  title = "Pre vs Post (Limma with Patient Pairing)",
  fc_threshold = 1.5,
  pval_threshold = 0.05
)
```

## 6.3 Segment-Specific Analysis

```{r de_by_segment}
# Analyze each segment type separately
segment_types <- unique(SP$segment)

deg_by_segment <- list()

for (seg in segment_types) {
  message("Analyzing segment: ", seg)
  
  # Subset to this segment
  samples_seg <- SP %>% filter(segment == seg) %>% rownames()
  
  if (length(samples_seg) < 6) {
    message("  Skipping (too few samples)")
    next
  }
  
  # Run DE
  deg_by_segment[[seg]] <- find_deg_geomx(
    data = q3_norm[, samples_seg],
    metadata = SP[samples_seg, ],
    group_col = "timepoint",
    comparison = c("post", "pre"),
    test_method = "wilcox"
  )
  
  message("  Found ", sum(deg_by_segment[[seg]]$p_adj < 0.05), " significant genes")
}

# View results for each segment
for (seg in names(deg_by_segment)) {
  cat("\n=== ", seg, " ===\n")
  print(head(deg_by_segment[[seg]] %>% arrange(p_adj), 10))
}
```

## 6.4 Linear Mixed Models (Complex Designs)

```{r lmm_analysis}
# For complex designs with patient as random effect
# Using refactored differential_expression.R

# Create configuration
config <- create_analysis_config(
  patient = "patho_id",
  drug = "drug_type",        # If you have different drugs
  timepoint = "timepoint",
  response = "Endo remission"  # Clinical response
)

# Select top variable genes for LMM (it's computationally intensive)
var_genes <- gene_metrics %>%
  arrange(desc(detection_rate)) %>%
  head(500) %>%
  pull(gene)

# Run LMM analysis
lmm_results <- run_lmm_multiple_genes(
  seurat_obj = sobj,
  genes = var_genes,
  config = config,
  n_cores = 4,
  verbose = TRUE
)

# View summary
head(lmm_results$summary %>% arrange(p_adj), 30)

# Find genes associated with treatment response
if ("response" %in% names(config)) {
  response_genes <- find_response_differential_genes(
    lmm_summary = lmm_results$summary,
    config = config,
    top_n = 50
  )
  
  print(response_genes)
}
```

---

# 7. Pathway Enrichment Analysis

```{r pathway_analysis}
# Using refactored pathway_enrichment.R

# Run on overall pre vs post DEGs
pathway_results <- myGO(
  deg_results = deg_limma %>% rename(gene = gene, avg_log2FC = logFC, p_val_adj = adj.P.Val),
  run_go = TRUE,
  run_kegg = TRUE,
  run_gsea = TRUE,
  go_ont = "BP",
  gsea_category = c("H", "C2"),  # Hallmark and curated gene sets
  padj_threshold = 0.05,
  logfc_threshold = 0.5
)

# View GO results
if (!is.null(pathway_results$GO_formatted)) {
  cat("\n=== Top GO Terms ===\n")
  print(head(pathway_results$GO_formatted, 20))
}

# View GSEA results
if (!is.null(pathway_results$GSEA_formatted)) {
  cat("\n=== Top GSEA Pathways ===\n")
  print(head(pathway_results$GSEA_formatted, 20))
}

# Visualize top pathways
if (!is.null(pathway_results$GO_formatted)) {
  top_go <- pathway_results$GO_formatted %>%
    head(15) %>%
    mutate(Description = factor(Description, levels = rev(Description)))
  
  ggplot(top_go, aes(x = -log10(p.adjust), y = Description)) +
    geom_bar(stat = "identity", fill = "steelblue") +
    theme_minimal() +
    labs(x = "-log10(adjusted p-value)", y = "", title = "Top GO Terms")
}
```

---

# 8. Gene Signature Analysis

## 8.1 Module Scoring

```{r module_scoring}
# Using refactored signature_scoring.R

# Define gene sets of interest
gene_sets <- list(
  Inflammation = c("IL6", "IL1B", "TNF", "CXCL8", "CCL2"),
  T_cell = c("CD3D", "CD3E", "CD4", "CD8A", "IL2"),
  B_cell = c("MS4A1", "CD79A", "CD79B", "IGHM"),
  Fibrosis = c("COL1A1", "COL3A1", "ACTA2", "FN1", "TGFB1"),
  Healing = c("VEGFA", "PDGFA", "FGF2", "HGF", "EGF")
)

# Add module scores
sobj <- AddMultipleModuleScores(
  seurat_obj = sobj,
  gene_sets = gene_sets,
  name_suffix = "Score"
)

# Visualize module scores
PlotModuleScoreHeatmap(
  seurat_obj = sobj,
  gene_sets = gene_sets,
  group_by = "timepoint",
  split_by = NULL,
  score_suffix = "Score"
)

# Compare scores between pre/post
score_cols <- paste0(names(gene_sets), "Score")

for (score in score_cols) {
  cat("\n=== ", score, " ===\n")
  
  # Box plot
  p <- ggplot(sobj@meta.data, aes_string(x = "timepoint", y = score, fill = "timepoint")) +
    geom_boxplot() +
    geom_jitter(width = 0.2, alpha = 0.3) +
    theme_minimal() +
    ggtitle(score)
  
  print(p)
  
  # Statistical test
  test_res <- wilcox.test(
    sobj@meta.data[sobj@meta.data$timepoint == "pre", score],
    sobj@meta.data[sobj@meta.data$timepoint == "post", score]
  )
  
  cat("  Wilcoxon p-value: ", test_res$p.value, "\n")
}
```

## 8.2 Biomarker Discovery

```{r biomarker_discovery}
# Using refactored signature_discovery.R

# Find biomarkers for treatment response
biomarker_sig <- find_gene_signature(
  data = sobj,
  target_var = "Endo remission",  # Your response variable
  method = "lasso",  # or tree_based, limma, etc.
  n_features = 30,
  preprocess = TRUE,
  use_seurat = TRUE
)

# View signature
print(biomarker_sig)

# Evaluate performance
if (!is.null(biomarker_sig$performance)) {
  cat("\nModel Performance:\n")
  cat("  AUC: ", biomarker_sig$performance$auc, "\n")
  cat("  Accuracy: ", biomarker_sig$performance$accuracy, "\n")
}

# Visualize top biomarkers
if (length(biomarker_sig$features) > 0) {
  top_biomarkers <- head(biomarker_sig$features, 10)
  
  # Heatmap of top biomarkers
  biomarker_expr <- GetAssayData(sobj, slot = "data")[top_biomarkers, ]
  
  pheatmap(
    biomarker_expr,
    scale = "row",
    annotation_col = SP %>% select(timepoint, `Endo remission`),
    show_colnames = FALSE,
    main = "Top Biomarkers"
  )
}
```

---

# 9. Advanced Visualizations

## 9.1 Heatmaps of DEGs

```{r deg_heatmap}
# Using refactored plot_deg_heatmap

# Get top DEGs
top_degs <- deg_limma %>%
  filter(adj.P.Val < 0.05, abs(logFC) > 1) %>%
  arrange(adj.P.Val) %>%
  head(50) %>%
  pull(gene)

if (length(top_degs) > 0) {
  plot_deg_heatmap(
    data = q3_norm,
    metadata = SP,
    genes = top_degs,
    group_col = "timepoint",
    split_col = "segment",
    scale_rows = TRUE,
    cluster_rows = TRUE,
    cluster_cols = TRUE
  )
}
```

## 9.2 Correlation Analysis

```{r correlation}
# Correlate gene expression with clinical variables

# Example: Correlate top DEGs with clinical response
if ("clinical_score" %in% colnames(SP)) {
  
  cor_results <- lapply(top_degs, function(gene) {
    expr <- q3_norm[gene, ]
    clinical <- SP$clinical_score
    
    cor_test <- cor.test(expr, clinical, method = "spearman")
    
    data.frame(
      gene = gene,
      rho = cor_test$estimate,
      p_value = cor_test$p.value
    )
  }) %>% bind_rows() %>%
    mutate(p_adj = p.adjust(p_value, method = "BH")) %>%
    arrange(p_value)
  
  print(head(cor_results, 20))
}
```

## 9.3 Custom Visualizations

```{r custom_viz}
# Box plots for key genes
genes_of_interest <- c("IL6", "TNF", "CXCL8", "IL1B")  # Adjust based on your DEGs

for (gene in genes_of_interest) {
  if (gene %in% rownames(q3_norm)) {
    
    plot_data <- data.frame(
      expression = q3_norm[gene, ],
      timepoint = SP$timepoint,
      segment = SP$segment,
      patient = SP$patho_id
    )
    
    p <- ggplot(plot_data, aes(x = timepoint, y = expression, fill = timepoint)) +
      geom_boxplot(outlier.shape = NA) +
      geom_point(position = position_jitter(width = 0.2), alpha = 0.5) +
      facet_wrap(~ segment, scales = "free_y") +
      theme_minimal() +
      ggtitle(paste(gene, "Expression"))
    
    print(p)
  }
}
```

---

# 10. Save Results

```{r save_results}
# Create results directory structure
dir.create(file.path(output_dir, "DE_results"), showWarnings = FALSE)
dir.create(file.path(output_dir, "pathway_results"), showWarnings = FALSE)
dir.create(file.path(output_dir, "figures"), showWarnings = FALSE)

# Save Seurat object
saveRDS(sobj, file = file.path(output_dir, "mibd_seurat_processed.rds"))

# Save normalized data
saveRDS(q3_norm, file = file.path(output_dir, "q3_normalized_data.rds"))

# Save DE results
saveRDS(deg_limma, file = file.path(output_dir, "DE_results/limma_pre_vs_post.rds"))
saveRDS(deg_by_segment, file = file.path(output_dir, "DE_results/by_segment.rds"))

if (exists("lmm_results")) {
  saveRDS(lmm_results, file = file.path(output_dir, "DE_results/lmm_results.rds"))
}

# Save pathway results
saveRDS(pathway_results, file = file.path(output_dir, "pathway_results/pathway_enrichment.rds"))

# Export to Excel
library(openxlsx)

# Create comprehensive Excel workbook
wb <- createWorkbook()

# Sheet 1: Overall DE results
addWorksheet(wb, "DE_Overall")
writeData(wb, "DE_Overall", deg_limma)

# Sheet 2-N: Segment-specific results
for (seg in names(deg_by_segment)) {
  sheet_name <- gsub("[^A-Za-z0-9_]", "_", seg)  # Clean sheet name
  sheet_name <- substr(sheet_name, 1, 31)  # Excel sheet name limit
  
  addWorksheet(wb, sheet_name)
  writeData(wb, sheet_name, deg_by_segment[[seg]])
}

# Sheet: Pathway results
if (!is.null(pathway_results$GO_formatted)) {
  addWorksheet(wb, "GO_Pathways")
  writeData(wb, "GO_Pathways", pathway_results$GO_formatted)
}

if (!is.null(pathway_results$GSEA_formatted)) {
  addWorksheet(wb, "GSEA_Pathways")
  writeData(wb, "GSEA_Pathways", pathway_results$GSEA_formatted)
}

# Save workbook
saveWorkbook(wb, 
             file = file.path(output_dir, "mIBD_comprehensive_results.xlsx"), 
             overwrite = TRUE)

message("Results saved to: ", output_dir)
```

---

# 11. Generate Report Summary

```{r summary}
cat("\n========================================\n")
cat("ANALYSIS SUMMARY\n")
cat("========================================\n\n")

cat("Dataset:\n")
cat("  - Genes:", nrow(q3_norm), "\n")
cat("  - Samples:", ncol(q3_norm), "\n")
cat("  - Patients:", length(unique(SP$patho_id)), "\n")
cat("  - Segments:", paste(unique(SP$segment), collapse = ", "), "\n\n")

cat("Differential Expression (Pre vs Post):\n")
cat("  - Total DEGs (p.adj < 0.05):", sum(deg_limma$adj.P.Val < 0.05), "\n")
cat("  - Upregulated in Post:", sum(deg_limma$adj.P.Val < 0.05 & deg_limma$logFC > 0), "\n")
cat("  - Downregulated in Post:", sum(deg_limma$adj.P.Val < 0.05 & deg_limma$logFC < 0), "\n\n")

if (!is.null(pathway_results$GO_formatted)) {
  cat("Pathway Enrichment:\n")
  cat("  - Significant GO terms:", sum(pathway_results$GO_formatted$p.adjust < 0.05), "\n")
}

if (!is.null(pathway_results$GSEA_formatted)) {
  cat("  - Significant GSEA pathways:", sum(pathway_results$GSEA_formatted$padj < 0.05), "\n")
}

cat("\n========================================\n")
```

---

# Session Info

```{r session_info}
sessionInfo()
```

---

# Notes and Interpretation

## Key Findings

**Differential Expression:**
- [ ] Top upregulated genes in post-treatment
- [ ] Top downregulated genes in post-treatment
- [ ] Segment-specific patterns

**Pathway Analysis:**
- [ ] Enriched biological processes
- [ ] Key signaling pathways affected
- [ ] Inflammation/healing signatures

**Clinical Correlations:**
- [ ] Biomarkers for treatment response
- [ ] Patient-specific patterns
- [ ] Predictive signatures

## Next Steps

- [ ] Validate key findings with qPCR or IHC
- [ ] Integrate with other IBD datasets
- [ ] Functional validation of top targets
- [ ] Develop predictive models for treatment response

## References

1. NanoString GeoMx Digital Spatial Profiler
2. Relevant IBD literature
3. Method references

---

**Analysis completed:** `r Sys.Date()`  
**Analyst:** Jaecheon Ko

