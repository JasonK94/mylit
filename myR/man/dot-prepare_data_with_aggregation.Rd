% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils_aggregation.R
\name{.prepare_data_with_aggregation}
\alias{.prepare_data_with_aggregation}
\title{Prepare Data with Flexible Aggregation}
\usage{
.prepare_data_with_aggregation(
  data,
  features,
  group.by = NULL,
  split.by = NULL,
  sample_col = NULL,
  aggregate = FALSE,
  aggregate_by = NULL,
  agg_fun = "mean",
  min_cells = 1,
  assay = NULL,
  layer = "data",
  metadata_df = NULL,
  match_id = NULL
)
}
\arguments{
\item{data}{Seurat object or data.frame}

\item{features}{Character vector of features}

\item{group.by}{Character. Grouping variable for faceting}

\item{split.by}{Character. Splitting variable for x-axis/color}

\item{sample_col}{Character. Sample/patient ID column (for aggregation)}

\item{aggregate}{Logical. Whether to aggregate cells (default: FALSE)}

\item{aggregate_by}{Character vector. Variables to aggregate by.
If NULL and sample_col is provided, uses sample_col.
If NULL and aggregate=TRUE, uses group.by and split.by.}

\item{agg_fun}{Character. Aggregation function (default: "mean")}

\item{min_cells}{Integer. Minimum cells per group for aggregation}

\item{assay}{Character. Assay to use (Seurat only)}

\item{layer}{Character. Layer to use (Seurat only)}

\item{metadata_df}{Optional data.frame. Additional metadata}

\item{match_id}{Character. Column for matching metadata}
}
\value{
data.frame ready for plotting
}
\description{
Main function for preparing plot data with optional aggregation.
Supports Seurat/df input, metadata joining, and multi-level aggregation.
}
\examples{
\dontrun{
# Cell-level data
plot_df <- .prepare_data_with_aggregation(
  data = sobj,
  features = "CD3D",
  group.by = "cell_type",
  split.by = "condition"
)

# Aggregated by patient
plot_df <- .prepare_data_with_aggregation(
  data = sobj,
  features = "CD3D",
  group.by = "cell_type",
  split.by = "condition",
  sample_col = "patient",
  aggregate = TRUE
)
}

}
\keyword{internal}
