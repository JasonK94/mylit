% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analysis.R
\name{runNEBULA}
\alias{runNEBULA}
\title{Run NEBULA differential expression analysis}
\usage{
runNEBULA(
  sobj,
  layer = "counts",
  fixed_effects = c("g3"),
  covar_effects = NULL,
  patient_col = "hos_no",
  offset = "nCount_RNA",
  min_count = 10,
  remove_na_cells = TRUE,
  formula = NULL,
  pseudobulk = FALSE,
  pseudobulk_args = list(),
  separation_min_cells = 20,
  simplify_interactions = TRUE,
  separation_group_var = NULL,
  separation_min_cells_per_group = 3
)
}
\arguments{
\item{sobj}{Seurat object}

\item{layer}{Assay layer to use (default: "counts")}

\item{fixed_effects}{Character vector of fixed effects used in the classic
interface.}

\item{covar_effects}{Character vector of covariates.}

\item{patient_col}{Column name for patient/sample ID.}

\item{offset}{Column name for offset variable.}

\item{min_count}{Minimum number of cells expressing a gene.}

\item{remove_na_cells}{Remove cells with NA in model variables.}

\item{formula}{Optional lme4-style formula string or object.}

\item{pseudobulk}{Logical or list to enable the pseudobulk workflow.}

\item{pseudobulk_args}{Named list overriding pseudobulk defaults
(e.g., cluster/sample identifiers, offsets, filtering thresholds).}

\item{separation_min_cells}{Minimum cells required for each factor level when
using the formula mode. Levels below the threshold are pruned to avoid
complete separation (default: 20).}

\item{simplify_interactions}{When TRUE (default) problematic interaction
terms detected during formula analysis are dropped automatically to avoid
singular design matrices.}

\item{separation_group_var}{Optional metadata column used to enforce gene-level
balance (e.g., treatment group). When supplied, genes must have non-zero
expression in at least \code{separation_min_cells_per_group} cells for every
level of this column.}

\item{separation_min_cells_per_group}{Minimum number of cells per level for
the gene-level balance filter (default: 3).}
}
\value{
NEBULA result object. When pseudobulk mode is enabled a list is
returned containing the NEBULA result plus the pseudobulk counts/metadata.
}
\description{
Unified interface for NEBULA-based differential expression.  Use \code{formula} to
activate the formula parser or \code{pseudobulk}/\code{pseudobulk_args} to trigger the
pseudobulk workflow.
}
