% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/legacy.R
\name{run_pseudobulk_deg_legacy2}
\alias{run_pseudobulk_deg_legacy2}
\title{Pseudo-bulk Differential Gene Expression Analysis}
\usage{
run_pseudobulk_deg_legacy2(
  analysis_level = c("overall", "per_cluster", "specific_cluster"),
  contrast,
  target_cluster = NULL,
  min_samples_per_group_cluster = 2,
  min_count = 10,
  ...,
  verbose = TRUE
)
}
\arguments{
\item{analysis_level}{분석 수준:
- "overall": 모든 클러스터를 통합하여 전체 그룹 간 비교 (코드 1 방식).
- "per_cluster": 각 클러스터 내에서 그룹 간 비교 (코드 2 방식).
- "specific_cluster": 지정된 단일 클러스터 내에서 그룹 간 비교.}

\item{contrast}{edgeR의 glmQLFTest에 전달할 contrast 벡터. 그룹 레벨 순서에 맞게 지정해야 함.
예: 그룹 레벨이 c("Control", "Treatment")일 때 Treatment vs Control 비교는 c(-1, 1).
prepare_pseudobulk_edgeR 결과의 contrast_levels 참고.}

\item{target_cluster}{analysis_level이 "specific_cluster"일 때 분석할 클러스터 이름.}

\item{min_samples_per_group_cluster}{클러스터별 분석 시, 각 그룹이 가져야 하는 최소 샘플 수.
미달 시 해당 클러스터 분석 건너뜀 (기본값: 2).}

\item{...}{prepare_pseudobulk_edgeR 함수에 전달할 인자들 (seurat_obj, assay, slot, sample_col, cluster_col, group_col 등)
또는 prepare_pseudobulk_edgeR 함수의 반환값인 리스트 (pb, meta, dge, design 포함).}

\item{verbose}{진행 상황 출력 여부 (기본값: TRUE)}
}
\value{
DEG 결과 테이블 (tibble).
- "overall" 분석: 단일 tibble.
- "per_cluster" 분석: 각 클러스터 결과가 합쳐진 tibble (cluster 컬럼 포함).
- "specific_cluster" 분석: 해당 클러스터 결과만 담긴 tibble (cluster 컬럼 포함).
결과 테이블에는 logFC, logCPM, F, PValue, FDR 등의 edgeR 결과와 gene 컬럼이 포함됩니다.
}
\description{
주어진 Seurat 객체 또는 준비된 pseudo-bulk 데이터에 대해
다양한 수준의 edgeR 기반 DEG 분석을 수행합니다.
}
\examples{
\dontrun{
# 예제 데이터 준비 (prepare_pseudobulk_edgeR 예제 참고)
counts <- matrix(rpois(10000, lambda = 10), ncol=100, nrow=100)
rownames(counts) <- paste0("Gene", 1:100)
colnames(counts) <- paste0("Cell", 1:100)
metadata <- data.frame(
  sample_id = sample(paste0("Sample", 1:4), 100, replace = TRUE),
  cell_type = sample(paste0("Cluster", 1:3), 100, replace = TRUE),
  condition = NA,
  row.names = paste0("Cell", 1:100)
)
metadata$condition[metadata$sample_id \%in\% c("Sample1", "Sample2")] <- "Control"
metadata$condition[metadata$sample_id \%in\% c("Sample3", "Sample4")] <- "Treatment"
seurat_obj_example <- CreateSeuratObject(counts = counts, meta.data = metadata)
seurat_obj_example[["SCT"]] <- seurat_obj_example[["RNA"]] # 예시용

# 사용례 1: 전체 그룹 간 비교 (Overall)
overall_results <- run_pseudobulk_deg(
  analysis_level = "overall",
  contrast = c(-1, 1), # Treatment vs Control (Control이 첫번째 레벨이라고 가정)
  seurat_obj = seurat_obj_example,
  assay = "SCT", slot = "counts",
  sample_col = "sample_id", cluster_col = "cell_type", group_col = "condition"
)
head(overall_results)

# 사용례 2: 클러스터별 그룹 간 비교 (Per Cluster)
per_cluster_results <- run_pseudobulk_deg(
  analysis_level = "per_cluster",
  contrast = c(-1, 1),
  seurat_obj = seurat_obj_example,
  assay = "SCT", slot = "counts",
  sample_col = "sample_id", cluster_col = "cell_type", group_col = "condition"
)
head(per_cluster_results)
table(per_cluster_results$cluster) # 각 클러스터별 결과 확인

# 사용례 3: 특정 클러스터("Cluster2") 내 그룹 간 비교 (Specific Cluster)
specific_cluster_results <- run_pseudobulk_deg(
  analysis_level = "specific_cluster",
  target_cluster = "Cluster2",
  contrast = c(-1, 1),
  seurat_obj = seurat_obj_example,
  assay = "SCT", slot = "counts",
  sample_col = "sample_id", cluster_col = "cell_type", group_col = "condition"
)
head(specific_cluster_results)
}
}
