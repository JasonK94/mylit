% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/test_gpt.R
\name{milo_neighborhood_da_v4}
\alias{milo_neighborhood_da_v4}
\title{MILO neighborhood DA (flexible reductions; v4)}
\usage{
milo_neighborhood_da_v4(
  sobj,
  target_var,
  batch_var,
  patient_var,
  cluster_var,
  graph_reduction,
  layout_reduction = NULL,
  k = 30,
  d = NULL,
  prop = 0.1,
  fixed_effects = NULL,
  random_effects = NULL,
  glmm_family = c("nb", "poisson"),
  p_adj_method = "BH",
  fdr_thresh = 0.1,
  logfc_thresh = 0.5,
  seed = 1,
  use_future = FALSE,
  workers = max(1, parallel::detectCores() - 1)
)
}
\arguments{
\item{sobj}{Seurat object.}

\item{target_var, batch_var, patient_var, cluster_var}{Character; column names in meta.data.}

\item{graph_reduction}{Character; Seurat reduction name used for Milo graph (e.g., "pca","integrated.scvi"). Required.}

\item{layout_reduction}{Character or NULL; reduction for plotting/positions (e.g., "umap","umap.scvi"). Optional.}

\item{k, d, prop}{Milo graph/neighborhood params. If \code{d=NULL}, uses all columns of \code{graph_reduction}.}

\item{fixed_effects}{Character vector; defaults to c(target_var, batch_var).}

\item{random_effects}{Character vector; if length>0, GLMM mode.}

\item{glmm_family}{"nb" (default) or "poisson".}

\item{p_adj_method}{"BH" etc.}

\item{fdr_thresh, logfc_thresh}{Thresholds for significance.}

\item{seed}{RNG seed.}

\item{use_future}{Logical; GLMM 병렬 시 \code{future.apply} 사용.}

\item{workers}{Integer workers for future (if \code{use_future=TRUE}).}
}
\value{
list(mode, milo, da_nhood_with_cluster, da_by_cluster, formula(optional))
}
\description{
Neighborhood DA with:
\itemize{
\item (A) edgeR GLM + spatial FDR (fixed effects only), or
\item (B) GLMM via glmmTMB (random effects; adj.p as conservative spatialFDR).
Uses arbitrary Seurat reductions (e.g., "integrated.scvi", "umap.scvi").
}
}
\examples{
# scVI 임베딩 사용
out <- milo_neighborhood_da_v4(
  sobj = data_seurat,
  target_var="g3", batch_var="GEM", patient_var="hos_no", cluster_var="anno3.scvi",
  graph_reduction="integrated.scvi", layout_reduction="umap.scvi",
  fixed_effects=c("g3","GEM")
)
}
