% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/milo_pipeline.R
\name{test_cluster_logfc_bias}
\alias{test_cluster_logfc_bias}
\title{Test cluster-wise logFC bias in Milo DA results}
\usage{
test_cluster_logfc_bias(
  da_results,
  milo,
  cluster_col = "major_cluster",
  block_method = c("sample", "community", "none"),
  test_methods = c("permutation", "neff"),
  n_perm = 2000L,
  max_nhoods = NULL,
  block_var = NULL,
  seed = 1L,
  verbose = TRUE
)
}
\arguments{
\item{da_results}{Data frame from \code{miloR::testNhoods()} with columns \code{Nhood}, \code{logFC}, \code{PValue}, etc.}

\item{milo}{Milo object containing nhood membership matrix and graph.}

\item{cluster_col}{Character string; column name in \code{da_results} containing cluster identities (default: \code{"major_cluster"}).}

\item{block_method}{Character; method for creating blocks: \code{"sample"} (extract from cell names), \code{"community"} (graph-based), or \code{"none"} (no blocking).}

\item{test_methods}{Character vector; which tests to run: \code{"permutation"}, \code{"neff"}, \code{"lmm"}, \code{"ashr"}.}

\item{n_perm}{Integer; number of permutations for block permutation test (default: 2000).}

\item{max_nhoods}{Optional integer; if provided, randomly sample this many neighborhoods for faster testing.}

\item{block_var}{Optional character; column name in \code{colData(milo)} to use for blocking (e.g., \code{patient_var}, \code{batch_var}). If \code{NULL}, attempts to extract from cell names.}

\item{seed}{Integer; random seed for reproducibility (default: 1).}

\item{verbose}{Logical; emit progress messages.}
}
\value{
Data frame with columns:
\itemize{
\item \code{cluster}: cluster identity
\item \code{mean_logFC}: mean logFC per cluster
\item \code{p_perm}: p-value from block permutation (if \code{"permutation"} in \code{test_methods})
\item \code{p_neff}: p-value from correlation-adjusted t-test (if \code{"neff"} in \code{test_methods})
\item \code{p_lmm}: p-value from mixed-effects model (if \code{"lmm"} in \code{test_methods})
\item \code{eb_mean}: Empirical Bayes posterior mean (if \code{"ashr"} in \code{test_methods})
}
}
\description{
Tests whether logFC values are systematically biased (enriched/depleted) per cluster,
accounting for non-independence between neighborhoods using block permutation,
correlation-adjusted t-test, or mixed-effects models.
}
