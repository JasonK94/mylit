% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/milo_pipeline.R
\name{run_milo_pipeline}
\alias{run_milo_pipeline}
\title{Milo pipeline orchestrator}
\usage{
run_milo_pipeline(
  seurat_obj = NULL,
  seurat_qs_path = NULL,
  patient_var,
  cluster_var,
  target_var,
  batch_var,
  graph_reduction = "integrated.scvi",
  layout_reduction = "umap.scvi",
  k = 30,
  d = 30,
  prop = 0.1,
  alpha = 0.1,
  cell_metric = c("SpatialFDR", "PValue", "logFC_percentile"),
  beeswarm_metric = c("SpatialFDR", "PValue", "logFC_percentile"),
  beeswarm_alpha = alpha,
  fdr_breaks = c(0, 0.1, 0.2, 0.3, 0.5, 1),
  fdr_labels = c("< 0.1", "0.1 - 0.2", "0.2 - 0.3", "0.3 - 0.5", ">= 0.5"),
  save = TRUE,
  output_dir = file.path(tempdir(), "milo"),
  prefix = "milo",
  suffix = NULL,
  force_run = FALSE,
  plotting = TRUE,
  max_cells = NULL,
  seed = 1L,
  verbose = TRUE
)
}
\arguments{
\item{seurat_obj}{A \code{Seurat} object already loaded in memory. If \code{NULL},
\code{seurat_qs_path} must be provided.}

\item{seurat_qs_path}{Optional path to a \code{.qs} file containing a \code{Seurat}
object. Used when \code{seurat_obj} is \code{NULL}.}

\item{patient_var, cluster_var, target_var, batch_var}{Metadata column names
required for Milo DA testing.}

\item{graph_reduction}{Reduction slot used to build Milo neighbourhoods.}

\item{layout_reduction}{Reduction slot used to populate the Milo UMAP layout.}

\item{k, d, prop}{Parameters forwarded to \code{buildGraph()} / \code{makeNhoods()}.}

\item{alpha}{Default significance threshold used across plots.}

\item{cell_metric}{Metric used to colour cells in UMAP (supports
\code{"SpatialFDR"}, \code{"PValue"}, \code{"logFC_percentile"}).}

\item{beeswarm_metric}{Metric added to \code{da_results} for colouring the
beeswarm plot. Same options as \code{cell_metric}.}

\item{beeswarm_alpha}{Threshold passed to \code{plotDAbeeswarm()}.}

\item{fdr_breaks, fdr_labels}{Bin specification for colouring cells by metric.}

\item{save}{Logical; if \code{TRUE} (default) intermediate objects are written to
disk using \code{qs::qsave()}.}

\item{output_dir, prefix, suffix}{Configure save location. When \code{suffix} is
\code{NULL}, a numeric suffix (\verb{"", "_1", ...}) is auto-generated to avoid
overwriting existing files.}

\item{force_run}{Logical scalar or named logical vector controlling whether
each step (\code{nhoods}, \code{distances}, \code{testing}) is recomputed even if cached
files are present.}

\item{plotting}{Logical; if \code{FALSE}, plotting helpers are skipped.}

\item{max_cells}{Optional integer. When set and lower than the total number
of cells, a random subset is used to accelerate development runs.}

\item{seed}{Integer passed to \code{set.seed()} before sampling or Milo routines.}

\item{verbose}{Logical; emits progress messages when \code{TRUE}.}
}
\value{
A list with \code{milo} (the Milo object), \code{da_results} (data frame), and
\code{plots} (list of ggplot objects; \code{NULL} when \code{plotting = FALSE}).
}
\description{
Wraps the Milo differential abundance workflow into reusable steps with
configurable saving, force-run, and plotting behaviour. The implementation is
distilled from the \code{st/KDW_251110.Rmd} notebook (lines 3476-3868) and
incorporates lessons learned during manual debugging (see \code{context_Korean.md}).
}
