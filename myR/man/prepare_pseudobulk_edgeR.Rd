% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pseudobulk_deg.R
\name{prepare_pseudobulk_edgeR}
\alias{prepare_pseudobulk_edgeR}
\title{Pseudo-bulk 데이터 생성 및 edgeR 분석 준비 함수}
\usage{
prepare_pseudobulk_edgeR(
  seurat_obj,
  assay = "SCT",
  slot = "counts",
  sample_col,
  cluster_col,
  group_col,
  min_count = 10,
  norm_method = "TMM",
  design_formula = NULL,
  verbose = TRUE
)
}
\arguments{
\item{seurat_obj}{Seurat 객체}

\item{assay}{사용할 assay 이름 (기본값: "SCT")}

\item{slot}{사용할 slot 이름 (기본값: "counts"). AggregateExpression은 raw count 사용 권장.}

\item{sample_col}{메타데이터에서 샘플을 구분하는 컬럼 이름}

\item{cluster_col}{메타데이터에서 클러스터를 구분하는 컬럼 이름}

\item{group_col}{메타데이터에서 비교할 그룹을 구분하는 컬럼 이름}

\item{min_count}{filterByExpr에서 사용할 최소 카운트 (기본값: 10)}

\item{norm_method}{calcNormFactors에서 사용할 정규화 방법 (기본값: "TMM")}

\item{design_formula}{모델 디자인 ფორმულა. 예: ~ group_col 또는 ~ 0 + group_col.
NULL이면 기본값(~ group_col) 사용. 그룹 컬럼 이름이 group_col 변수값으로 자동 대체됩니다.}

\item{verbose}{진행 상황 출력 여부 (기본값: TRUE)}
}
\value{
리스트:
- pb: Pseudo-bulk 발현 매트릭스 (genes x sample_cluster)
- meta: Pseudo-bulk 샘플에 대한 메타데이터 (patient, ctype, group 포함)
- dge: 필터링 및 정규화된 DGEList 객체
- design: 생성된 디자인 매트릭스
- contrast_levels: 그룹 컬럼의 레벨 (contrast 설정 시 참고용)
}
\description{
Seurat 객체로부터 pseudo-bulk 데이터를 생성하고, edgeR 분석을 위한
DGEList 객체, 디자인 매트릭스 등을 준비합니다.
}
\examples{
\dontrun{
# 예제 데이터 생성 (실제 사용 시 실제 Seurat 객체로 대체)
counts <- matrix(rpois(10000, lambda = 10), ncol=100, nrow=100)
rownames(counts) <- paste0("Gene", 1:100)
colnames(counts) <- paste0("Cell", 1:100)
metadata <- data.frame(
  exp_sample_no = sample(paste0("Sample", 1:4), 100, replace = TRUE),
  annotation2_big = sample(paste0("Cluster", 1:3), 100, replace = TRUE),
  group3 = NA,
  row.names = paste0("Cell", 1:100)
)
metadata$group3[metadata$exp_sample_no \%in\% c("Sample1", "Sample2")] <- "Control"
metadata$group3[metadata$exp_sample_no \%in\% c("Sample3", "Sample4")] <- "Treatment"
seurat_obj_example <- CreateSeuratObject(counts = counts, meta.data = metadata)
# SCT assay가 없으므로 RNA assay 사용 예시
seurat_obj_example[["SCT"]] <- seurat_obj_example[["RNA"]] # 예시를 위해 복사

prep_data <- prepare_pseudobulk_edgeR(
  seurat_obj = seurat_obj_example,
  assay = "SCT", # 또는 "RNA" 등
  slot = "counts",
  sample_col = "exp_sample_no",
  cluster_col = "annotation2_big",
  group_col = "group3"
)

print(prep_data$contrast_levels) # 그룹 레벨 확인

# edgeR 분석 수행 (예: 그룹 간 비교)
# contrast 설정 (예: Treatment vs Control)
# prep_data$contrast_levels 결과 보고 순서 맞게 설정
# 예를 들어 contrast_levels가 c("Control", "Treatment") 라면
my_contrast <- c(-1, 1)

dge <- estimateDisp(prep_data$dge, prep_data$design)
fit <- glmQLFit(dge, prep_data$design)
qlf <- glmQLFTest(fit, contrast = my_contrast)
results <- topTags(qlf, n = Inf)$table
head(results)
}
}
