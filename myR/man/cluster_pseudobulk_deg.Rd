% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pseudobulk_deg.R
\name{cluster_pseudobulk_deg}
\alias{cluster_pseudobulk_deg}
\title{Identify Cluster Markers using Pseudo-bulk DEG}
\usage{
cluster_pseudobulk_deg(
  sobj,
  sample_col,
  group.by = "seurat_clusters",
  assay = NULL,
  layer = "data",
  slot = NULL,
  features = NULL,
  ident.1 = NULL,
  ident.2 = NULL,
  logfc.threshold = 0.1,
  test.use = "wilcox",
  min.pct = 0.1,
  min.diff.pct = -Inf,
  only.pos = FALSE,
  norm_method_edgeR = "TMM",
  min_count_edgeR = 10,
  p_adjust_method = "BH",
  verbose = TRUE,
  ...
)
}
\arguments{
\item{sobj}{A Seurat object.}

\item{sample_col}{Character string. The column name in \code{sobj@meta.data} that
identifies individual biological samples/replicates. This is crucial for
forming pseudo-bulks.}

\item{group.by}{Character string. The metadata column to use for defining clusters
(e.g., "seurat_clusters"). Default is "seurat_clusters".}

\item{assay}{Character string. Assay to use. If NULL, uses DefaultAssay(sobj).}

\item{layer}{Character string. Layer to use from the assay (Seurat v5).
Default is "data". If using Seurat v3/4, consider using the \code{slot} argument.}

\item{slot}{Character string. Slot to use from the assay (Seurat v3/v4).
If \code{layer} is also provided, \code{layer} takes precedence. If NULL and \code{layer} is also NULL,
defaults to "data" for \code{pct.1}/\code{pct.2} and "counts" for DEG methods.}

\item{features}{Character vector. Genes to test. If NULL, tests all genes.}

\item{ident.1}{Character or NULL. Identity of the first group. If NULL,
finds markers for all clusters against the rest (like FindAllMarkers).}

\item{ident.2}{Character or NULL. Identity of the second group. If NULL and
\code{ident.1} is specified, \code{ident.1} is compared against all other clusters.}

\item{logfc.threshold}{Numeric. Limit testing to genes which show, on average,
at least X-fold difference (log-scale). Default is 0.1.}

\item{test.use}{Character. Statistical test to use. Options are "wilcox" (uses
edgeR via \code{run_pseudobulk_deg}) or "t-test" (performs t-tests on pseudo-bulk averages).
Default is "wilcox".}

\item{min.pct}{Numeric. Only test genes that are detected in a minimum fraction
of cells in either of the two populations. Default is 0.1.}

\item{min.diff.pct}{Numeric. Only test genes that show a minimum difference in
the fraction of detection between the two groups. Default is -Inf (no filter).}

\item{only.pos}{Logical. Only return positive markers (positive avg_log2FC). Default is FALSE.}

\item{norm_method_edgeR}{Character. Normalization method for edgeR if \code{test.use = "wilcox"}.
Default is "TMM". Passed to \code{prepare_pseudobulk_edgeR}.}

\item{min_count_edgeR}{Numeric. Minimum count for \code{filterByExpr} if \code{test.use = "wilcox"}.
Default is 10. Passed to \code{prepare_pseudobulk_edgeR}.}

\item{p_adjust_method}{Character. Method for p-value adjustment (e.g., "BH", "bonferroni"). Default is "BH".}

\item{verbose}{Logical. Print progress messages. Default is TRUE.}

\item{...}{Additional arguments passed to downstream functions if any (currently not extensively used).}
}
\value{
A data frame (or a list of data frames if \code{ident.1} is NULL and multiple
clusters are tested) containing marker genes, log2 fold changes, p-values,
adjusted p-values, and percentage of cells expressing the gene in each group.
The columns are named to be similar to Seurat's \code{FindMarkers} output.
}
\description{
This function identifies marker genes for specified clusters by performing
pseudo-bulk differential expression analysis. It is similar to Seurat's
FindMarkers/FindAllMarkers but uses a pseudo-bulk approach based on edgeR
or t-tests.
}
