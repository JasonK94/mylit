% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CCI.R
\name{run_nichenet_analysis}
\alias{run_nichenet_analysis}
\title{Perform NicheNet Cell-Cell Communication Analysis}
\usage{
run_nichenet_analysis(
  seurat_obj,
  species = c("human", "mouse"),
  sender_celltypes,
  receiver_celltype,
  assay_name = "SCT",
  cluster_col,
  receiver_DE_ident1,
  receiver_DE_ident2 = NULL,
  receiver_DE_group_by,
  receiver_de_table = NULL,
  receiver_gene_col = "gene",
  receiver_logfc_col = NULL,
  receiver_pval_col = NULL,
  min_pct_expressed = 0.1,
  p_val_adj_cutoff = 0.05,
  logfc_cutoff = 0.25,
  top_n_ligands = 20,
  top_n_targets_per_ligand = 200,
  ligand_target_cutoff = 0.33,
  nichenet_data_dir = NULL,
  nichenet_data_name = "NicheNetData",
  output_dir = NULL,
  run_circos = TRUE,
  ...,
  verbose = TRUE
)
}
\arguments{
\item{seurat_obj}{A Seurat object containing the single-cell expression data.}

\item{species}{Character string, either "human" or "mouse", to load the appropriate NicheNet databases.}

\item{sender_celltypes}{Character vector of cell types acting as senders.}

\item{receiver_celltype}{Character string of the cell type acting as the receiver.}

\item{assay_name}{Character string, the name of the assay in the Seurat object to use (e.g., "SCT", "RNA"). Default: "SCT".}

\item{cluster_col}{Character string, the name of the metadata column in \code{seurat_obj} that contains cell type or cluster annotations.
This will be used to set \code{Idents(seurat_obj)}.}

\item{receiver_DE_ident1}{Character string, the identity for \code{ident.1} in \code{FindMarkers} for DE analysis within the \code{receiver_celltype}.}

\item{receiver_DE_ident2}{Character string, the identity for \code{ident.2} in \code{FindMarkers} (e.g., control group). Can be NULL if comparing against all other cells in \code{receiver_DE_group_by}.}

\item{receiver_DE_group_by}{Character string, the metadata column used for \code{group.by} in \code{FindMarkers} for DE analysis within the \code{receiver_celltype}.}

\item{min_pct_expressed}{Numeric, minimum fraction of cells in which a gene must be expressed in sender/receiver groups for initial filtering. Default: 0.10.}

\item{p_val_adj_cutoff}{Numeric, adjusted p-value cutoff for DEGs. Default: 0.05.}

\item{logfc_cutoff}{Numeric, log fold-change cutoff for DEGs (positive values for upregulation in ident1). Default: 0.25.}

\item{top_n_ligands}{Integer, number of top ligands to consider for detailed analysis and visualization. Default: 20.}

\item{top_n_targets_per_ligand}{Integer, number of top target genes to show per ligand in visualizations. Default: 200.}

\item{ligand_target_cutoff}{Numeric, cutoff for visualizing ligand-target links (e.g., based on regulatory potential). Default: 0.33.}

\item{nichenet_data_dir}{Character string, path to the directory for local caching of NicheNet's RDS data files.
Used if data is not found in the global environment object specified by \code{nichenet_data_name}.
If NULL, a species-specific default path within the working directory will be used (e.g., "./nichenet_data_human/").}

\item{nichenet_data_name}{Character string or NULL. The name of the R object in the Global Environment
where NicheNet datasets are stored or will be stored. If NULL, data is not stored/retrieved globally by this function.
Default: "NicheNetData".}

\item{output_dir}{Character string, path to a main directory where run-specific subfolders for outputs will be created. If NULL, plots are returned but not saved to files. Default: NULL.}

\item{run_circos}{Logical, whether to attempt to generate and return a circos plot of ligand-receptor interactions. Requires \code{circlize}, \code{RColorBrewer}, and \code{evaluate} packages. Default: TRUE.}

\item{verbose}{Logical, whether to print progress messages and summary of warnings. Default: TRUE.}

\item{run_signaling_path_inference}{Logical, whether to infer and visualize ligand-to-target signaling paths for the top 1 ligand. Requires \code{DiagrammeR}, \code{DiagrammeRsvg}, \code{rsvg}. Default: FALSE.}
}
\value{
A list containing:
\itemize{
\item \code{ligand_activities}: DataFrame of ligand activities.
\item \code{best_upstream_ligands}: Character vector of top N ligands.
\item \code{active_ligand_target_links_df}: DataFrame of active ligand-target links.
\item \code{plot_ligand_target_network}: ggplot object of the ligand-target heatmap.
\item \code{ligand_receptor_network_df}: DataFrame of prioritized ligand-receptor interactions.
\item \code{plot_ligand_receptor_network}: ggplot object of the ligand-receptor heatmap.
\item \code{plot_ligand_activity_hist}: ggplot object of ligand activity histogram.
\item \code{plot_ligand_aupr_heatmap}: ggplot object of top ligand AUPR heatmap.
\item \code{DE_table_receiver}: DataFrame of differentially expressed genes in the receiver.
\item \code{plot_circos}: A recorded circos plot object (replay with \code{plot()}) or a status message.
\item \code{circos_notes}: Character vector of "Note:" messages captured during circos plot generation.
\item \code{signaling_path_graph}: A DiagrammeR graph object or NULL.
\item \code{nichenet_data_loaded_info}: List describing how NicheNet data was loaded.
\item \code{output_path_run}: Path to the run-specific output directory if \code{output_dir} was provided.
\item \code{warnings_occurred}: A character vector of warning messages collected during execution, if any.
}
}
\description{
This function wraps the NicheNet analysis pipeline to identify key ligands,
their target genes, and receptors involved in cell-cell communication between
defined sender and receiver cell populations. It handles loading of NicheNet's
prior interaction data, with options for local caching, global environment storage,
and downloading from Zenodo if necessary.
}
\details{
To visualize ligand expression (e.g., as a DotPlot or Heatmap), you can use the returned
\code{best_upstream_ligands} and your original \code{seurat_obj}. For example:
\code{Seurat::DotPlot(seurat_obj, features = results$best_upstream_ligands, group.by = "your_celltype_column")}
For a more integrated graphical legend with the Circos plot, consider using the \code{ComplexHeatmap} package's \code{Legend} function externally.
}
